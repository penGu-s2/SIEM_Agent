# ===== PARSERS CHO CÁC ĐỊNH DẠNG LOG PHỔ BIẾN =====

# Syslog RFC5424 (đã có)
[PARSER]
    Name        syslog-rfc5424
    Format      regex
    Regex       ^\<(?<pri>[0-9]+)\>(?<version>[0-9]+)\s+(?<timestamp>[^ ]+)\s+(?<host>[^ ]+)\s+(?<app>[^ ]+)\s+(?<pid>[-0-9]+)\s+(?<msgid>[^ ]+)\s+(?<extradata>(\[(.*)\]|-))\s+(?<message>.+)$
    Time_Key    timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%L%z
    Time_Keep   On

# Syslog RFC3164 (bổ sung)
[PARSER]
    Name        syslog-rfc3164
    Format      regex
    Regex       ^\<(?<pri>[0-9]+)\>(?<timestamp>[A-Z][a-z]{2}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2})\s+(?<host>[^:]+):\s+(?<message>.*)$
    Time_Key    timestamp
    Time_Format %b %d %H:%M:%S
    Time_Keep   On

# Common Event Format (CEF)
[PARSER]
    Name        cef
    Format      regex
    Regex       ^CEF:(?<version>\d+)\|(?<vendor>[^|]+)\|(?<product>[^|]+)\|(?<version>[^|]+)\|(?<signature>[^|]+)\|(?<name>[^|]+)\|(?<severity>[^|]+)\|(?<extension>.*)$
    Time_Key    timestamp
    Time_Format %b %d %H:%M:%S
    Time_Keep   On

# Log Event Extended Format (LEEF)
[PARSER]
    Name        leef
    Format      regex
    Regex       ^LEEF:(?<version>\d+)\|(?<vendor>[^|]+)\|(?<product>[^|]+)\|(?<version>[^|]+)\|(?<eventid>[^|]+)\|(?<extension>.*)$
    Time_Key    timestamp
    Time_Format %b %d %H:%M:%S
    Time_Keep   On

# CSV Format
[PARSER]
    Name        csv
    Format      csv
    Time_Key    timestamp
    Time_Format %Y-%m-%d %H:%M:%S
    Time_Keep   On

# XML Format
[PARSER]
    Name        xml
    Format      xml
    Time_Key    timestamp
    Time_Format %Y-%m-%d %H:%M:%S
    Time_Keep   On

# JSON Format
[PARSER]
    Name        json
    Format      json
    Time_Key    timestamp
    Time_Format %Y-%m-%d %H:%M:%S
    Time_Keep   On

# Apache Access Log
[PARSER]
    Name        apache
    Format      regex
    Regex       ^(?<host>[^ ]*) [^ ]* (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^ ]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)")?$
    Time_Key    time
    Time_Format %d/%b/%Y:%H:%M:%S %z
    Time_Keep   On

# Nginx Access Log
[PARSER]
    Name        nginx
    Format      regex
    Regex       ^(?<remote>[^ ]*) (?<host>[^ ]*) (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^ ]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)")?$
    Time_Key    time
    Time_Format %d/%b/%Y:%H:%M:%S %z
    Time_Keep   On

# IIS Log
[PARSER]
    Name        iis
    Format      regex
    Regex       ^(?<date>\d{4}-\d{2}-\d{2})\s+(?<time>\d{2}:\d{2}:\d{2})\s+(?<s_ip>[^ ]+)\s+(?<cs_method>[^ ]+)\s+(?<cs_uri_stem>[^ ]+)\s+(?<cs_uri_query>[^ ]+)\s+(?<s_port>[^ ]+)\s+(?<cs_username>[^ ]+)\s+(?<c_ip>[^ ]+)\s+(?<cs_user_agent>[^ ]+)\s+(?<cs_cookie>[^ ]+)\s+(?<cs_referer>[^ ]+)\s+(?<cs_host>[^ ]+)\s+(?<sc_status>[^ ]+)\s+(?<sc_substatus>[^ ]+)\s+(?<sc_win32_status>[^ ]+)\s+(?<time_taken>[^ ]+)$
    Time_Key    date
    Time_Format %Y-%m-%d
    Time_Keep   On

# Windows Security Event Log
[PARSER]
    Name        win_security
    Format      regex
    Regex       ^(?<timestamp>\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z)\s+(?<event_id>\d+)\s+(?<level>[^ ]+)\s+(?<source>[^ ]+)\s+(?<message>.*)$
    Time_Key    timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%LZ
    Time_Keep   On

# Firewall Log (Cisco ASA)
[PARSER]
    Name        cisco_asa
    Format      regex
    Regex       ^(?<timestamp>\w+ \d+ \d{2}:\d{2}:\d{2})\s+(?<hostname>[^:]+):\s+%ASA-(?<level>\d+)-(\d+):\s+(?<message>.*)$
    Time_Key    timestamp
    Time_Format %b %d %H:%M:%S
    Time_Keep   On

# NetFlow v5
[PARSER]
    Name        netflow_v5
    Format      regex
    Regex       ^(?<src_ip>\d+\.\d+\.\d+\.\d+)\s+(?<dst_ip>\d+\.\d+\.\d+\.\d+)\s+(?<src_port>\d+)\s+(?<dst_port>\d+)\s+(?<protocol>\d+)\s+(?<packets>\d+)\s+(?<bytes>\d+)\s+(?<timestamp>\d+)$
    Time_Key    timestamp
    Time_Format %s
    Time_Keep   On

# Custom Plain Text Log
[PARSER]
    Name        custom_plain
    Format      regex
    Regex       ^(?<timestamp>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})\s+\[(?<level>[^\]]+)\]\s+(?<component>[^:]+):\s+(?<message>.*)$
    Time_Key    timestamp
    Time_Format %Y-%m-%d %H:%M:%S
    Time_Keep   On

# Docker Log
[PARSER]
    Name        docker
    Format      json
    Time_Key    time
    Time_Format %Y-%m-%dT%H:%M:%S.%LZ
    Time_Keep   On

# Kubernetes Log
[PARSER]
    Name        kubernetes
    Format      json
    Time_Key    time
    Time_Format %Y-%m-%dT%H:%M:%S.%LZ
    Time_Keep   On

# AWS CloudTrail
[PARSER]
    Name        aws_cloudtrail
    Format      json
    Time_Key    eventTime
    Time_Format %Y-%m-%dT%H:%M:%SZ
    Time_Keep   On

# Azure Activity Log
[PARSER]
    Name        azure_activity
    Format      json
    Time_Key    eventTimestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%LZ
    Time_Keep   On

# GCP Audit Log
[PARSER]
    Name        gcp_audit
    Format      json
    Time_Key    timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%LZ
    Time_Keep   On

# SNMP Trap
[PARSER]
    Name        snmp_trap
    Format      regex
    Regex       ^(?<timestamp>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})\s+SNMP\s+Trap\s+from\s+(?<source>[^:]+):\s+(?<message>.*)$
    Time_Key    timestamp
    Time_Format %Y-%m-%d %H:%M:%S
    Time_Keep   On

# IDS/IPS Alert (Snort)
[PARSER]
    Name        snort_alert
    Format      regex
    Regex       ^(?<timestamp>\d{2}/\d{2}-\d{2}:\d{2}:\d{2}\.\d{6})\s+\[(?<gid>\d+):(?<sid>\d+):(?<rev>\d+)\]\s+(?<msg>[^:]+):\s+(?<classification>[^:]+):\s+(?<priority>\d+):\s+(?<protocol>[^:]+):\s+(?<src_ip>\d+\.\d+\.\d+\.\d+):(?<src_port>\d+)\s+->\s+(?<dst_ip>\d+\.\d+\.\d+\.\d+):(?<dst_port>\d+)$
    Time_Key    timestamp
    Time_Format %m/%d-%H:%M:%S.%f
    Time_Keep   On

# Antivirus Log (Windows Defender)
[PARSER]
    Name        windows_defender
    Format      regex
    Regex       ^(?<timestamp>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})\s+\[(?<level>[^\]]+)\]\s+Windows\s+Defender\s+(?<action>[^:]+):\s+(?<threat>[^:]+):\s+(?<file_path>[^:]+):\s+(?<message>.*)$
    Time_Key    timestamp
    Time_Format %Y-%m-%d %H:%M:%S
    Time_Keep   On

# EDR Log (CrowdStrike)
[PARSER]
    Name        crowdstrike
    Format      json
    Time_Key    timestamp
    Time_Format %Y-%m-%dT%H:%M:%S.%LZ
    Time_Keep   On 